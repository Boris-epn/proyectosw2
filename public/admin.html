<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Piestudio - Login</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<div class="container">
  <div class="card">
    <h1>Poliestudio</h1>
    <p class="mt-2">Inicia sesión con tu usuario y contraseña.</p>

    <form id="loginForm" class="mt-3">
      <div class="input-group">
        <label for="usuario">Usuario</label>
        <input type="text" id="usuario" required />
      </div>

      <div class="input-group">
        <label for="contrasena">Contraseña</label>
        <input type="password" id="contrasena" required />
      </div>

      <button type="submit">Ingresar</button>
    </form>

    <p id="loginError" class="mt-3" style="color:#dc2626;"></p>
  </div>
</div>

<script src="app.js"></script>
<script>
  const form = document.getElementById('loginForm');
  const errorLabel = document.getElementById('loginError');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorLabel.textContent = '';

    const usuario = document.getElementById('usuario').value;
    const contrasena = document.getElementById('contrasena').value;

    try {
      const res = await fetch(API_URL + '/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ usuario, contrasena })
      });

      if (!res.ok) {
        const data = await res.json();
        errorLabel.textContent = data.error || 'Error de autenticación';
        return;
      }

      const data = await res.json();
      guardarSesion(data);

      // redirigir según rol
      if (data.rol === 'administrador') window.location.href = 'admin.html';
      else if (data.rol === 'profesor') window.location.href = 'profesor.html';
      else if (data.rol === 'estudiante') window.location.href = 'estudiante.html';
      else if (data.rol === 'representante') window.location.href = 'representante.html';
      else errorLabel.textContent = 'No se pudo determinar el rol.';
    } catch (err) {
      console.error(err);
      errorLabel.textContent = 'Error de conexión con el servidor.';
    }
  });
</script>
</body>
</html>
